\section{Theoretical Analysis}
\label{sec:analysis}

In this section, the circuit shown in Figure~\ref{fig:circuit} is analysed
theoretically, first we aproach the circuit using the mesh analysis, and later we analyse the circuit using the nodal analysis.


\subsection{Nodal Analysis}

The general point of the node analysis method is to figure out the node voltages of all the nodes in our circuit (in relation to a reference node,
which we call ground, and whose voltage we set to 0). Having figured this out,
it's straightforward to determine the branch currents and voltages, thus completely solving the circuit. 
\par

\begin{figure}[H] \centering
  \includegraphics[width=0.6\linewidth]{nodal.pdf}
  \caption{Nodes used in Nodal Analysis}
  \label{fig:nodal}
\end{figure}

To do this, we first need to identify and label all the nodes in our system as seen in Figure~\ref{fig:nodal},
 as well as choose the ground node. In our case, we defined the node connected to 
 resistance $R_4$ and to voltage source $V_a$ as ground. The second step consists in determining
  the voltages of the easy nodes. In our circuit, it is clear to see, for example, that $e_1 = V_a$.
   To solve the other non-trivial nodes, we proceed to write Kirchhoff's current law for each one of them,
    which states that the sum of currents going into a node must be 0;
     or, in other words, that charges may not accumulate in one singular node:
\begin{equation*}
    \sum_{i} y_i = 0
\end{equation*}
where $y_i$ is a current defined as going \textbf{into} the node.\par
Using Ohm's Law, which states that $I = U/R$, and assuming we know the values of the resistances
 of the elements in each branch (also noticing that we can write the branch
  voltages as differences between node voltages), we get a system of equations that
   allows us to determine each node voltage.
\par
Since this method seems to rely upon Ohm's law, it seems to be a fatal problem that we have a dependent voltage source in our circuit,
$V_c$, for which we \textbf{can't} write ohm's law. To deal with this,
we create a super-node by lumping together the nodes to which $V_c$ is connected and we write KCL
for the super-node. To find the missing equation, we simply note that
$V$(negative terminal of dependent voltage source) + $V_c$ = $V$(positive terminal of dependent voltage source),
thus getting two equations for our two "problematic" nodes.

We can therefore write the following equations:

\begin{equation*}
  \mathbf{Node_1} : e_1 = V_a
  \label{eq:kcl0}
\end{equation*}
\begin{equation*}
  \mathbf{Node_2} : -C_1 \cdot (e_1 - e_2) - C_3 \cdot (e_8 - K_c \cdot C_{6,7} \cdot e_8 - e_2) - C_2 \cdot (e_3 - e_2) = 0
  \label{eq:kcl1}
\end{equation*}
\begin{equation*}
  \mathbf{Node_3} : C_2 \cdot (e_3 - e_2) - K_b \cdot (e_2 - e_8 + K_c \cdot C_{6,7} \cdot e_8) = 0
  \label{eq:kcl2}
\end{equation*}
\begin{equation*}
  \mathbf{Node_6} : C_5 \cdot (e_6 - e_8 + K_c \cdot C_{6,7} \cdot e_8) + K_b \cdot (e_2 - e_8 + K_c \cdot C_{6,7} \cdot e_8) - I_d = 0
  \label{eq:kcl3}
\end{equation*}
\begin{equation*}
    \mathbf{SuperNode} : -C_4 \cdot (-e_8 + K_c \cdot C_{6,7} \cdot e_8) + C_3 \cdot (e_8 - k_c \cdot C_{6,7} \cdot e_8 - e_2) - C_5 (e_6 - e_8 + k_c \cdot C_{6,7} \cdot e_8) + e_8 \cdot C_{6,7} + I_d = 0
\end{equation*}


In determining these equations, we have used, as for the the mesh analysis, the relations:


\begin{equation*}
    I_b = K_b \times V_b
\end{equation*}
\begin{equation*}
    V_b = (e_2 - e_8 + V_c)
\end{equation*}
\begin{equation*}
    V_c = K_c \times I_c
\end{equation*}
\begin{equation*}
    I_c = -e_8 \times C_{6,7}
\end{equation*}

In matrix form, the system of looks like this:
\vspace{10mm}


$\begin{bmatrix}
C_1 + C_2 + C_3  &  -C_2                 &  0        &  -C_3(1-K_c \cdot C_{6,7}) \\
-C_2 - K_b        &  C_2      &  0           &  K_b \cdot (1 - K_c \cdot C_{6,7}) \\
K_b             & 0                     &  C_5
&  -(C_5 + K_b)(1 - K_c C_{6,7}) \\
-C_3 & 0 & -C_5 & (1-K_c \cdot C_{6,7})(C_4 + C_3 + C_5) + C_{6,7}
\end{bmatrix}
\begin{bmatrix}
e_1 \\
e_2 \\
e_3 \\
e_4
\end{bmatrix}
=
\begin{bmatrix}
V_a \cdot C_1 \\
0 \\
I_d \\
-I_d
\end{bmatrix}$

\vspace{10mm}

Solving the system with octave and the previous data we reach the following results:
 Table with results created with octave
 \input{../mat/ex1_octave.tex}